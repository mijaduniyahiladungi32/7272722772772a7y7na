- name: Checkout target repository
  uses: actions/checkout@v4
  with:
    repository: ${{ secrets.API_U1 }}
    token: ${{ secrets.API_U2 }}
    ref: main

- name: Confirm zip file exists (debug)
  run: |
    ls -al
    if [ ! -f run.zip ]; then
      echo "❌ run.zip NOT FOUND"
      exit 1
    else
      echo "✅ run.zip found"
    fi

- name: Install dependencies
  run: |
    sudo apt-get update
    sudo apt-get install -y unzip
    pip install requests

- name: Unzip to random temp folder, run, then always delete
  run: |
    TMPDIR=$(mktemp -d)
    echo "Using temp folder: $TMPDIR"
    unzip -P "${{ secrets.ZIP_PASSWORD2 }}" run.zip -d "$TMPDIR"
    ls -al "$TMPDIR"
    python "$TMPDIR/run.py" || echo "⚠️ Python script failed"
    rm -rf "$TMPDIR"
